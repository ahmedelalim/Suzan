<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تصريح دخول</title>

<style>
    body {
        background: #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: "Arial", sans-serif;
        padding: 20px;
    }

    textarea {
        width: 90%;
        height: 150px;
        margin-bottom: 15px;
        font-size: 18px;
        padding: 10px;
    }

    button {
        padding: 12px 20px;
        font-size: 18px;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .page {
        width: 210mm;
        height: 297mm;
        background-image: url("background.jpg");
        background-size: 100% 100%; /* fit entire page */
        background-repeat: no-repeat;
        background-position: center;
        position: relative;
        padding: 25mm;
        box-sizing: border-box;
        display: none;
    }

    .date {
        position: absolute;
        top: 25mm;   /* moved lower */
        left: 40mm;  /* moved right */
        font-size: 100px;
    }

    .text-box {
        position: absolute;
        top: 55mm;
        right: 25mm;
        left: 25mm;
        bottom: 25mm;
        white-space: pre-wrap;
        font-size: 20px;
        line-height: 1.6;
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>

<textarea id="inputText" placeholder="اكتب النص هنا..."></textarea>

<button onclick="generatePDF()">تحميل صفحة PDF</button>
<button onclick="sharePDF()">شارك PDF</button>

<div class="page" id="page">
    <div class="date" id="dateArea"></div>
    <div class="text-box" id="outputText"></div>
</div>

<script>
async function generatePDF() {
    const text = document.getElementById("inputText").value;
    document.getElementById("outputText").innerText = text;

    const today = new Date().toLocaleDateString('ar-EG');
    document.getElementById("dateArea").innerText = today;

    const pageElement = document.getElementById("page");
    pageElement.style.display = "block";

    const canvas = await html2canvas(pageElement, { scale: 3 });
    const imgData = canvas.toDataURL("image/png");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");
    pdf.addImage(imgData, "PNG", 0, 0, 210, 297);

    pdf.save("تصريح دخول.pdf");
}

async function sharePDF() {
    const text = document.getElementById("inputText").value;
    document.getElementById("outputText").innerText = text;

    const today = new Date().toLocaleDateString('ar-EG');
    document.getElementById("dateArea").innerText = today;

    const pageElement = document.getElementById("page");
    pageElement.style.display = "block";

    const canvas = await html2canvas(pageElement, { scale: 3 });
    const imgData = canvas.toDataURL("image/png");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");
    pdf.addImage(imgData, "PNG", 0, 0, 210, 297);

    const fileName = "تصريح دخول.pdf";
    const pdfBlob = pdf.output("blob");

    if (navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], fileName, { type: "application/pdf" })] })) {
        const file = new File([pdfBlob], fileName, { type: "application/pdf" });
        await navigator.share({
            title: "تصريح دخول",
            text: "ملف تصريح دخول",
            files: [file]
        });
    } else {
        alert("متصفحك لا يدعم المشاركة المباشرة، سيتم تنزيل الملف بدلاً من ذلك.");
        pdf.save(fileName);
    }
}
</script>

</body>
</html>
